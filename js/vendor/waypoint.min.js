(function(e,t,n,r){var i=e(r),o="waypoint.reached",s=function(e,n){e.element.trigger(o,n),e.options.triggerOnce&&e.element[t]("destroy")},a=function(e,t){if(!t)return-1;for(var n=t.waypoints.length-1;n>=0&&t.waypoints[n].element[0]!==e[0];)n-=1;return n},u=[],l=function(t){e.extend(this,{element:e(t),oldScroll:0,waypoints:[],didScroll:!1,didResize:!1,doScroll:e.proxy(function(){var t=this.element.scrollTop(),r=t>this.oldScroll,i=this,o=e.grep(this.waypoints,function(e){return r?e.offset>i.oldScroll&&t>=e.offset:e.offset<=i.oldScroll&&e.offset>t}),a=o.length;this.oldScroll&&t||e[n]("refresh"),this.oldScroll=t,a&&(r||o.reverse(),e.each(o,function(e,t){(t.options.continuous||e===a-1)&&s(t,[r?"down":"up"])}))},this)}),e(t).bind("scroll.waypoints",e.proxy(function(){this.didScroll||(this.didScroll=!0,r.setTimeout(e.proxy(function(){this.doScroll(),this.didScroll=!1},this),e[n].settings.scrollThrottle))},this)).bind("resize.waypoints",e.proxy(function(){this.didResize||(this.didResize=!0,r.setTimeout(e.proxy(function(){e[n]("refresh"),this.didResize=!1},this),e[n].settings.resizeThrottle))},this)),i.load(e.proxy(function(){this.doScroll()},this))},c=function(t){var n=null;return e.each(u,function(e,r){return r.element[0]===t?(n=r,!1):void 0}),n},f={init:function(r,i){return this.each(function(){var s,f=e.fn[t].defaults.context,d=e(this);i&&i.context&&(f=i.context),e.isWindow(f)||(f=d.closest(f)[0]),s=c(f),s||(s=new l(f),u.push(s));var p=a(d,s),h=0>p?e.fn[t].defaults:s.waypoints[p].options,m=e.extend({},h,i);m.offset="bottom-in-view"===m.offset?function(){var t=e.isWindow(f)?e[n]("viewportHeight"):e(f).height();return t-e(this).outerHeight()}:m.offset,0>p?s.waypoints.push({element:d,offset:null,options:m}):s.waypoints[p].options=m,r&&d.bind(o,r),i&&i.handler&&d.bind(o,i.handler)}),e[n]("refresh"),this},remove:function(){return this.each(function(t,n){var r=e(n);e.each(u,function(e,t){var n=a(r,t);n>=0&&(t.waypoints.splice(n,1),t.waypoints.length||(t.element.unbind("scroll.waypoints resize.waypoints"),u.splice(e,1)))})})},destroy:function(){return this.unbind(o)[t]("remove")}},d={refresh:function(){e.each(u,function(t,r){var i=e.isWindow(r.element[0]),o=i?0:r.element.offset().top,a=i?e[n]("viewportHeight"):r.element.height(),u=i?0:r.element.scrollTop();e.each(r.waypoints,function(e,t){if(t){var n=t.options.offset,i=t.offset;if("function"==typeof t.options.offset)n=t.options.offset.apply(t.element);else if("string"==typeof t.options.offset){var l=parseFloat(t.options.offset);n=t.options.offset.indexOf("%")?Math.ceil(a*(l/100)):l}t.offset=t.element.offset().top-o+u-n,t.options.onlyOnScroll||(null!==i&&r.oldScroll>i&&r.oldScroll<=t.offset?s(t,["up"]):null!==i&&i>r.oldScroll&&r.oldScroll>=t.offset?s(t,["down"]):!i&&r.element.scrollTop()>t.offset&&s(t,["down"]))}}),r.waypoints.sort(function(e,t){return e.offset-t.offset})})},viewportHeight:function(){return r.innerHeight?r.innerHeight:i.height()},aggregate:function(){var t=e();return e.each(u,function(n,r){e.each(r.waypoints,function(e,n){t=t.add(n.element)})}),t}};e.fn[t]=function(n){return f[n]?f[n].apply(this,Array.prototype.slice.call(arguments,1)):"function"!=typeof n&&n?"object"==typeof n?f.init.apply(this,[null,n]):(e.error("Method "+n+" does not exist on jQuery "+t),void 0):f.init.apply(this,arguments)},e.fn[t].defaults={continuous:!0,offset:0,triggerOnce:!1,context:r},e[n]=function(e){return d[e]?d[e].apply(this):d.aggregate()},e[n].settings={resizeThrottle:200,scrollThrottle:100},i.load(function(){e[n]("refresh")})})(jQuery,"waypoint","waypoints",window);