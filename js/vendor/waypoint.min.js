(function(e,t,n,i){var r=e(i),o="waypoint.reached",s=function(e,n){e.element.trigger(o,n),e.options.triggerOnce&&e.element[t]("destroy")},a=function(e,t){if(!t)return-1;for(var n=t.waypoints.length-1;n>=0&&t.waypoints[n].element[0]!==e[0];)n-=1;return n},c=[],u=function(t){e.extend(this,{element:e(t),oldScroll:0,waypoints:[],didScroll:!1,didResize:!1,doScroll:e.proxy(function(){var t=this.element.scrollTop(),i=t>this.oldScroll,r=this,o=e.grep(this.waypoints,function(e){return i?e.offset>r.oldScroll&&t>=e.offset:e.offset<=r.oldScroll&&e.offset>t}),a=o.length;this.oldScroll&&t||e[n]("refresh"),this.oldScroll=t,a&&(i||o.reverse(),e.each(o,function(e,t){(t.options.continuous||e===a-1)&&s(t,[i?"down":"up"])}))},this)}),e(t).bind("scroll.waypoints",e.proxy(function(){this.didScroll||(this.didScroll=!0,i.setTimeout(e.proxy(function(){this.doScroll(),this.didScroll=!1},this),e[n].settings.scrollThrottle))},this)).bind("resize.waypoints",e.proxy(function(){this.didResize||(this.didResize=!0,i.setTimeout(e.proxy(function(){e[n]("refresh"),this.didResize=!1},this),e[n].settings.resizeThrottle))},this)),r.load(e.proxy(function(){this.doScroll()},this))},l=function(t){var n=null;return e.each(c,function(e,i){return i.element[0]===t?(n=i,!1):void 0}),n},f={init:function(i,r){return this.each(function(){var s,f=e.fn[t].defaults.context,d=e(this);r&&r.context&&(f=r.context),e.isWindow(f)||(f=d.closest(f)[0]),s=l(f),s||(s=new u(f),c.push(s));var p=a(d,s),h=0>p?e.fn[t].defaults:s.waypoints[p].options,m=e.extend({},h,r);m.offset="bottom-in-view"===m.offset?function(){var t=e.isWindow(f)?e[n]("viewportHeight"):e(f).height();return t-e(this).outerHeight()}:m.offset,0>p?s.waypoints.push({element:d,offset:null,options:m}):s.waypoints[p].options=m,i&&d.bind(o,i),r&&r.handler&&d.bind(o,r.handler)}),e[n]("refresh"),this},remove:function(){return this.each(function(t,n){var i=e(n);e.each(c,function(e,t){var n=a(i,t);n>=0&&(t.waypoints.splice(n,1),t.waypoints.length||(t.element.unbind("scroll.waypoints resize.waypoints"),c.splice(e,1)))})})},destroy:function(){return this.unbind(o)[t]("remove")}},d={refresh:function(){e.each(c,function(t,i){var r=e.isWindow(i.element[0]),o=r?0:i.element.offset().top,a=r?e[n]("viewportHeight"):i.element.height(),c=r?0:i.element.scrollTop();e.each(i.waypoints,function(e,t){if(t){var n=t.options.offset,r=t.offset;if("function"==typeof t.options.offset)n=t.options.offset.apply(t.element);else if("string"==typeof t.options.offset){var u=parseFloat(t.options.offset);n=t.options.offset.indexOf("%")?Math.ceil(a*(u/100)):u}t.offset=t.element.offset().top-o+c-n,t.options.onlyOnScroll||(null!==r&&i.oldScroll>r&&i.oldScroll<=t.offset?s(t,["up"]):null!==r&&r>i.oldScroll&&i.oldScroll>=t.offset?s(t,["down"]):!r&&i.element.scrollTop()>t.offset&&s(t,["down"]))}}),i.waypoints.sort(function(e,t){return e.offset-t.offset})})},viewportHeight:function(){return i.innerHeight?i.innerHeight:r.height()},aggregate:function(){var t=e();return e.each(c,function(n,i){e.each(i.waypoints,function(e,n){t=t.add(n.element)})}),t}};e.fn[t]=function(n){return f[n]?f[n].apply(this,Array.prototype.slice.call(arguments,1)):"function"!=typeof n&&n?"object"==typeof n?f.init.apply(this,[null,n]):(e.error("Method "+n+" does not exist on jQuery "+t),void 0):f.init.apply(this,arguments)},e.fn[t].defaults={continuous:!0,offset:0,triggerOnce:!1,context:i},e[n]=function(e){return d[e]?d[e].apply(this):d.aggregate()},e[n].settings={resizeThrottle:200,scrollThrottle:100},r.load(function(){e[n]("refresh")})})(jQuery,"waypoint","waypoints",window);